---
title: 进入 C++
description: 进入 C++
---

首先介绍一个显示消息的简单 C++ 程序，即使用 C++ 工具 `cout` 生成字符输出。源代码中包含一些供读者阅读的注释，这些注释都以 `//` 打头，编译器将忽略它们。C++ 对大小写敏感，也就是说区分大写字符和小写字符。这意味着大小写必须与示例中相同。例如，该程序使用的是 `cout`，如果将其替换为 Cout 或 COUT，程序将无法通过编译，并且编译器将指出使用了未知的标识符 (编译器也是对拼写敏感的，因此请不要使用 kout 或 coot)。文件扩展名 `cpp` 是一种表示 C++ 程序的常用方式，您可能需要使用第一章介绍的其他扩展名。

``` cpp
#include <iostream>                                                 // a PREPROCESSOR directive
int main()                                                                 // function header
{                                                                             // start of function body
    using namespace std;                                          // make definitions visible
    cout << "Come up and C++ me some time.";         // message
    cout << endl;                                                     // start a new line
    cout << "You won't regret it!" << endl;                 // more output
    return 0;                                                           // terminate main()
}                                                                          // end of function body
```

::: tip 程序调整
要在自己的系统上运行上述的代码示例，可能需要对其进行修改。有些窗口环境在独立的窗口中运行程序，并在程序运行完毕后自动关闭该窗口。正如第一章讨论的，要让窗口一直打开，直到您按任何键，可在 `return` 语句前添加一行语句 `cin.get()；`。对于有些程序，要让窗口一直打开，直到您按任何键，必须添加两条这样的语句。如果您使用的系统很旧，它可能不支持 C++98 新增的特性。有些程序要求编译器对 C++11 标准提供一定的支持。对于这样的程序，将明确地指出这一点，并在可能的情况下提供非 C++11 代码。
:::

下面是运行编译后的程序时得到的输出结果:

```
Come up and C++ me some time.
You won't regret it!
```

::: tip C语言的输入和输出
如果已经使用过 C 语言进行编程，则看到 `cout 函数` (而不是 `printf()` 函数) 时可能会小吃一惊。事实上，C++ 能够使用 `printf()`、`scanf()` 和其他所有标准 C 输入和输出函数，只需要包含常规 C 语言的 `stdio.h` 文件即可。不过本书介绍的是 C++，所以将使用 C++ 的输入工具，它们在 C 版本的基础上做了很多改进。
:::

使用函数来创建 C++ 程序时，通常先将程序组织为主要任务，然后设计独立的函数来处理这些任务。上述的代码示例非常简单，只包含一个名为 `main()` 的函数。代码示例包含下述元素:

- 注释，由前缀 `//` 标识
- 预处理器编译指令 `#include`
- 函数头 `int main()`
- 编译指令 `using namespace`
- 函数体，用 `{` 和 `}` 括起
- 使用 C++ 的 `cout` 工具显示消息的语句
- 结束 `main()` 函数的 `return` 语句

下面详细介绍这些元素。先来看看 `main()` 函数，因为了解 `main()` 的作用后，`main()` 前面的一些特性 (如预处理器编译指令) 将更易于理解。

## main() 函数

去掉修饰后，上述的示例程序的基本结构如下:

``` cpp
int main()
{
    statements
    return 0;
}
```

这几行表明有一个名为 `main()` 的函数，并描述了该函数的行为。这几行代码构成了函数定义 (function definition)。该定义由两部分组成：第一行 `int main()` 叫函数头 (function heading)，花括号 `{` 和 `}` 中包括的部分叫函数体。下图对 `main()` 函数做了说明。函数头对函数与程序其他部分之间的接口进行了总结；函数体是指出函数应做什么的计算机指令。在 C++ 中，每条完整的指令都称为语句。所有的语句都以分号结束，因此在输入示例代码时，请不要省略分号。`main()` 中最后一条语句叫做返回语句 (return statement)，它用于结束该函数。

![](../../../assets/2022/10/cxx-main-fuction.png)

::: tip 语句和分号
语句是要执行的操作。为理解源代码，编译器需要知道一条语句何时结束，另一条语句何时开始。有些语言使用语句分隔符。例如，FORTRAN 通过行尾将语句分隔开来，Pascal 使用分号分隔语句。在 Pascal 中，有些情况下可以省略分号，例如 END 前的语句后面，这种情况下，实际上并没有将两条语句分开。不过 C++ 与 C 一样，也使用终止符 (terminator)，而不是分隔符。终止符是一个分号，它是语句的结束标记，是语句的组成部分，而不是语句之间的标记。结论是：在 C++ 中，不能省略分号。
:::

### 作为接口的函数头

就目前而言，需要记住的主要一点是，C++ 句法要求 `main()` 函数的定义以函数头 `int main()` 开始。通常，C++ 函数可被其他函数激活或调用，函数头描述了函数与调用它的函数之间的接口。位于函数名前面的部分叫做函数返回类型，它描述的是从函数返回给调用它的函数的信息。函数名后括号中的部分叫做形参列表 (argument list) 或参数列表 (parameter list)； 它描述的是从调用函数传递给被调用的函数的信息。这种通用格式用于 `main()` 时让人感到有些迷惑，因为通常并不从程序的其他部分调用 `main()`。然而，通常，`main()` 被启动代码调用，而启动代码是由编译器添加到程序中的，是程序和操作系统 (UNIX、Windows 7 或其他操作系统) 之间的桥梁。事实上，该函数头描述的是 `main()` 和操作系统之间的接口。

来看一下 `main()` 的接口描述，该接口从 `int` 开始。C++ 函数可以给调用函数返回一个值，这个值叫做返回值 (return value)。在这里，从关键字 `int` 可知，`main()` 返回一个整数值。接下来，是空括号。通常，C++ 函数在调用另一个函数时，可以将信息传递给该函数。括号中的函数头部分描述的就是这种信息。在这里，空括号意味着 `main()` 函数不接受任何信息，或者 `main()` 不接受任何参数。`main()` 不接受任何参数并不意味着 `main()` 是不讲道理的、发号施令的函数。相反，术语参数 (argument) 只是计算机人员用来表示从一个函数传递给另一个函数的信息。

简而言之，下面的函数头表明 `main()` 函数可以给调用它的函数返回一个整数值，且不从调用它的函数那里获得任何信息:

``` cpp
int main()
```

很多现有的程序都使用经典 C 函数头。在 C 语言中，省略返回类型相当于函数的返回类型为 `int`，但 C++ 逐步淘汰了这种用法。

``` cpp
main()      // original C style
```

也可以使用下面的变体。在括号中使用关键字 `void` 明确地指出，函数不接受任何参数。在 C++ (不是 C) 中，让括号空着与在括号中使用 `void` 等效 (在 C 中，让括号空着意味着对是否接受参数保持沉默)。

``` cpp
int main(void)      // very explicit style
```

有些程序员使用下面的函数头，并省略返回语句。这在逻辑上是一致的，因为 `void` 返回类型意味着函数不返回任何值。该变体适用于很多系统，但由于它不是当前标准强制的一个选项，因此在有些系统上不能工作。因此，读者应避免使用这种格式，而应使用 C++ 标准格式，这不需要做太多的工作就能完成。

``` cpp
void main()
```


最后，ANSI/ISO C++ 标准对那些抱怨必须在 `main()` 函数最后包含一条返回语句过于繁琐的人做出了让步。如果编译器到达 `main()` 函数末尾时没有遇到返回语句，则认为 `main()` 函数以如下语句结尾。这条隐含的返回语句只适用于 `main()` 函数，而不适用于其他函数。

``` cpp
return 0;
```

### main() 函数不能使用其他名称

为什么 `main()` 函数不能使用其他名称呢？之所以将上述示例程序中的函数命名为 `main()`，原因是必须这样做。通常，C++ 程序必须包含一个名为 `main()` 的函数 (不是 Main()、MAIN () 或 mane ()。记住，大小写和拼写都要正确)。由于示例程序只有一个函数，因此该函数必须担负起 `main()` 的责任。在运行 C++ 程序时，通常从 `main()` 函数开始执行。因此，如果没有 `main()`，程序将不完整，编译器将指出未定义 `main()` 函数。

但存在一些例外情况。例如，在 Windows 编程中，可以编写一个动态链接库 (DLL) 模块，这是其他 Windows 程序可以使用的代码。由于 DLL 模块不是独立的程序，因此不需要 `main()`。用于专用环境的程序 — 例如机器人中的控制器芯片，可能不需要 `main()`。有些编程环境提供一个框架程序，该程序调用一些非标准函数，如 `_tmain()`。在这种情况下，有一个隐藏的 `main ()`，它会调用 `_tmain()`。但常规的独立程序都需要 `main()`，本书讨论的都是这种程序。
