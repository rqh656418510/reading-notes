---
title: 语言架构
description: 语言架构
---

## Rust 的语言架构

![](/images/2022/10/Rust概念层次结构.png)

最底层是安全内存管理层，该层主要是涉及内存管理相关的概念。倒数第二层是类型系统层，该层起到承上启下的作用。类型系统层承载了上层的所有权系统语义和混合编程范式，赋予了 Rust 语言高级的抽象表达能力和安全性。同时，还保留了对底层代码执行、数据表示和内存分配等操作的控制能力。

对于开发者而言，只需要掌握类型系统、所有权系统和混合式编程范式即可，不需要操心底层的内存是否安全，因为有编译器和类型系统帮忙处理。在这个语言架构之下，可以极大地保证系统的安全和健壮性。

## Rust 如何执行代码

Rust 是跨平台语言，一次编译，到处运行，这得益于 LLVM。Rust 编译器是一个 LLVM 编译前端，它将代码编译为 LLVM IR，然后经过 LLVM
编译为相应的平台目标。

Rust 源码经过分词和解析，生成 AST（抽象语法树）。然后把 AST 进一步简化处理为 HIR (High-level IR)，目的是让编译器更方便地做类型检查。HIR 会进一步被编译为 MIR (Middle IR)，这是一种中间表示，它在 Rust `1.12` 版本中被引入，主要用于以下目的。

- 缩短编译时间。MIR 可以帮助实现增量编译，当修改完代码重新编译的时候，编译器只计算更改过的部分，从而缩短了编译时间。
- 缩短执行时间。MIR 可以在 LLVM 编译之前实现更细粒度的优化，因为单纯依赖 LLVM 的优化粒度太粗，而且 Rust 无法控制，引入 MIR 就增加了更多的优化空间。
- 更精确的类型检查。MIR 将帮助实现更灵活的借用检查，从而可以提升 Rust 的使用体验。

最终，MIR 会被翻译为 LLVM IR，然后被 LLVM 的处理编译为能在各个平台上运行的目标机器码。
